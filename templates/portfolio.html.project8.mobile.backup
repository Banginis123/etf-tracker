<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="utf-8">
    <title>Portfolio</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/static/chart.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, sans-serif;
        }

        /* === PAGE LAYOUT === */

        .page {
            padding-left: 10px;
            padding-right: 10px;
            padding-bottom: 10px;
            padding-top: env(safe-area-inset-top);
        }

        @media (min-width: 768px) {
            .page {
                max-width: 1100px;
                margin: 0 auto;
                padding-top: 20px;
            }
        }

        /* ===== HEADER ===== */

        header {
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
        }

        .title-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 {
            margin: 0;
            font-size: clamp(2rem, 6vw, 2.6rem);
        }

        .settings-link {
            font-size: 1.6em;
            text-decoration: none;
        }

        /* ===== SUMMARY ===== */

        .summary {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 18px;
            font-size: 1rem;
        }

        /* ===== CHART ===== */

        .charts {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .chart-box {
            width: 100%;
            max-width: 340px; /* desktop */
        }

        /* === Project 8: Mobile UI overrides === */
        @media (max-width: 600px) {
            .chart-box {
                max-width: 245px; /* dar -15% */
            }
        }

        /* ===== TABLE ===== */

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        th, td {
            padding: 4px 6px;
            border-bottom: 1px solid #ddd;
        }

        thead th {
            background: #f5f5f5;
            font-weight: 600;
            text-align: center;
        }

        td.col-etf {
            text-align: left;
        }

        td.col-center {
            text-align: center;
        }

        td.col-value {
            text-align: right;
            font-weight: 600;
        }

        th.col-etf,
        th.col-center,
        th.col-value {
            text-align: center;
        }

        .positive { color: green; }
        .negative { color: red; }

        @media (max-width: 600px) {
            table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

<div class="page">

<header>
    <div class="title-wrap">
        <h2>üíº Portfolio</h2>
        <a href="/admin" class="settings-link" title="Settings">‚öôÔ∏è</a>
    </div>
</header>

<div class="summary">
    <div><strong>Total invested:</strong> {{ "%.2f"|format(totals.invested) }} ‚Ç¨</div>
    <div><strong>Current value:</strong> {{ "%.2f"|format(totals.current_value) }} ‚Ç¨</div>
    <div>
        <strong>P/L:</strong>
        <span class="{{ 'positive' if totals.pl_eur >= 0 else 'negative' }}">
            {{ "%.2f"|format(totals.pl_eur) }} ‚Ç¨
            ({{ "%.2f"|format(totals.pl_percent) }}%)
        </span>
    </div>
</div>

<div class="charts">
    <div class="chart-box">
        <canvas id="allocationChart"></canvas>
    </div>
</div>

<table>
    <thead>
        <tr>
            <th class="col-etf">ETF</th>
            <th class="col-center">Units</th>
            <th class="col-center">Avg</th>
            <th class="col-center">Current</th>
            <th class="col-value">Value</th>
            <th class="col-value">P/L</th>
        </tr>
    </thead>
    <tbody>
        {% for row in portfolio %}
        <tr>
            <td class="col-etf">{{ row.ticker }}</td>
            <td class="col-center">{{ "%.1f"|format(row.units) }}</td>
            <td class="col-center">{{ "%.2f"|format(row.avg_buy) }}</td>
            <td class="col-center">{{ "%.2f"|format(row.current_price) }}</td>
            <td class="col-value">{{ "%.2f"|format(row.current_value) }}</td>
            <td class="col-value {{ 'positive' if row.pl_eur >= 0 else 'negative' }}">
                {{ "%.2f"|format(row.pl_eur) }}
                ({{ "%.2f"|format(row.pl_percent) }}%)
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>

<script>
const labels = {{ portfolio | map(attribute='ticker') | list | safe }};
const allocations = {{ portfolio | map(attribute='allocation') | list | safe }};

const colors = [
    '#1f77b4','#d62728','#2ca02c','#9467bd',
    '#8c564b','#17becf','#e377c2','#7f7f7f'
];

new Chart(document.getElementById('allocationChart'), {
    type: 'pie',
    data: {
        labels: labels,
        datasets: [{
            data: allocations,
            backgroundColor: colors
        }]
    },
    options: {
        plugins: { legend: { position: 'bottom' } }
    }
});
</script>

</body>
</html>
